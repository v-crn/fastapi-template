steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/${_PROJECT}/${_IMAGE}', '-f', './Dockerfile', '.', '--no-cache', '--build-arg', '_ENV=dev']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/${_PROJECT}/${_IMAGE}']
- name: 'gcr.io/cloud-builders/gcloud'
  args: ['beta', 'run', 'deploy', '${_SERVICE}', '--image', 'gcr.io/${_PROJECT}/${_IMAGE}', '--region', '${_REGION}', '--platform', 'managed', '--memory', '4Gi', '--allow-unauthenticated', '--concurrency', '1', '--timeout', '3600s']
images:
- 'gcr.io/PROJECT_ID/${_IMAGE}'
substitutions:
  _PROJECT: PROJECT_ID
  _REGION: asia-northeast1
  _IMAGE: my_project
  _SERVICE: my_project
tags: ['0.0.1']
options:
  substitution_option: "MUST_MATCH"
